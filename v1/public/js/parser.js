// Generated by CoffeeScript 1.3.3
(function() {

  define('parser', ['common', 'hyphen'], function(Common, Hyphen) {
    var parse;
    parse = function(paragraph, width) {
      var cnt_width, end, sentences, start, w, w_index, word_width, _ref, _ref1;
      if (width == null) {
        width = 320;
      }
      if (paragraph.length > 10086) {
        return {
          status: -1,
          text: "大哥.太长了吧!~有木有搞错~~~(/= _ =)/~┴┴"
        };
      }
      sentences = Array();
      _ref = [0, 0, 0], start = _ref[0], end = _ref[1], cnt_width = _ref[2];
      for (w_index in paragraph) {
        w = paragraph[end = w_index];
        word_width = Common.get_word_width(w);
        if (cnt_width + word_width > width) {
          sentences.push(paragraph.slice(start, end));
          _ref1 = [end, 0], start = _ref1[0], cnt_width = _ref1[1];
        } else {
          cnt_width = cnt_width + word_width;
        }
      }
      return {
        status: 0,
        text: sentences.join('<br />')
      };
    };
    return {
      parse: parse
    };
  });

}).call(this);
